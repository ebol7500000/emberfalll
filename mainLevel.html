<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Itens Gamify</title>
    <link rel="icon" type="image/png" href="Gemini_Generated_Image_oza54roza54roza5.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Cores base para o tema */
        :root {
            --bg-color: #121212; /* Fundo principal (preto) */
            --main-color: #1e1e1e; /* Fundo de seções (cinza escuro) */
            --font-color: #e0e0e0; /* Cor da fonte (cinza claro) */
            --highlight-color: #d4a761; /* Cor de destaque (ouro envelhecido) */
            --highlight-gradient: linear-gradient(90deg, #d4a761, #ffcc77);
            --danger-color: #b73e3e; /* Cor para ações de perigo (vermelho) */
            --button-color: #555555; /* Cor para botões padrão (cinza) */
        }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle, #2e2e2e 1px, #121212 1px);
            background-size: 20px 20px;
            font-family: 'Poppins', sans-serif;
            color: var(--font-color);
            text-align: center;
            padding-bottom: 20px;
            margin: 0; /* Garante que não há margem padrão no body */
        }

        .main-container {
            width: 90%;
            max-width: 800px;
            margin: 20px auto; /* Centraliza o container principal */
            text-align: left; /* Alinha o texto dentro do container à esquerda */
        }

        h1 {
            font-family: 'Montserrat', sans-serif;
            color: var(--highlight-color);
            text-shadow: 0 0 10px rgba(212, 167, 97, 0.4);
            padding: 20px 0;
            border-bottom: 2px solid var(--highlight-color);
            display: block; /* Ocupa a largura total */
            margin: 20px 0; /* Ajusta margens superior e inferior */
            text-align: center; /* Centraliza o texto do H1 */
        }

        .scroll {
            background-color: var(--main-color);
            border: 2px solid #2e2e2e;
            border-radius: 12px;
            height: 400px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
            /* Removidas width e margin aqui, pois o .content já cuida disso */
        }
        
        .scroll::-webkit-scrollbar {
            width: 8px;
        }

        .scroll::-webkit-scrollbar-track {
            background: #333333;
            border-radius: 10px;
        }

        .scroll::-webkit-scrollbar-thumb {
            background: var(--highlight-color);
            border-radius: 10px;
        }

        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #2e2e2e;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            transition: background-color 0.3s, border-color 0.3s;
            border: 1px solid transparent;
        }
        
        .item:hover {
            background-color: #3e3e3e;
            border-color: var(--highlight-color);
        }

        .item img {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            border-radius: 5px;
            object-fit: cover;
        }
        
        .item span {
            flex-grow: 1;
            text-align: left;
        }
        
        .item button {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
        }
        
        .item button:hover {
            background-color: #9c2a2a;
        }

        .crud {
            margin-top: 20px;
            display: flex;
            flex-direction: column; /* Para empilhar os inputs */
            align-items: stretch; /* Estica os itens para preencher a largura */
            gap: 10px;
            background-color: var(--main-color);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #444;
        }
        
        .crud h3 {
            text-align: center; /* Centraliza o título "Adicionar Item" */
        }

        /* Contêiner para os botões de backup */
        .backup-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px 0; /* Adicionado padding para manter espaçamento interno */
        }

        input, button, select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #222;
            color: var(--font-color);
            font-family: inherit;
            transition: background-color 0.3s, border-color 0.3s;
            width: 100%; /* Faz inputs e selects ocuparem a largura total do crud */
            box-sizing: border-box; /* Inclui padding e border na largura total */
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--highlight-color);
            background-color: #333;
        }

        .crud button {
            background-color: var(--button-color);
            border: none;
            cursor: pointer;
            width: auto; /* Botões no CRUD podem ter largura automática */
            align-self: flex-end; /* Alinha o botão "Adicionar" à direita */
        }
        
        .crud button:hover {
            background-color: #666;
        }

        .backup-buttons button {
            background-color: var(--highlight-color);
            color: black;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            width: auto; /* Botões de backup podem ter largura automática */
        }

        .backup-buttons button:hover {
            background-color: #ffcc77;
        }
        
        input[type="file"]::file-selector-button {
            background-color: #444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: auto; /* Para não esticar o botão interno do file input */
        }
        
        input[type="file"]::file-selector-button:hover {
            background-color: #5a6268;
        }

        /* Barra de XP */
        .xp-container {
            margin: 20px 0; /* Ajustada para 0 nas laterais */
            background-color: var(--main-color);
            border: 1px solid #444;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            overflow: hidden;
            height: 30px;
            position: relative;
        }
        .xp-bar {
            height: 100%;
            background: var(--highlight-gradient);
            width: 0%;
            transition: width 0.5s ease;
        }
        .xp-text {
            position: absolute;
            width: 100%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 14px;
            color: #121212;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.4);
        }
        .level-display {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: var(--highlight-color);
            text-align: center; /* Centraliza o texto do nível */
        }

        /* Controle de XP/Level */
        .xp-control {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            display: flex; /* Usar flexbox para alinhar itens */
            flex-wrap: wrap; /* Permite que os itens quebrem linha */
            justify-content: center; /* Centraliza os itens */
            gap: 10px;
            margin-top: 20px;
            border: 1px solid #444;
            width: fit-content; /* Ajusta a largura ao conteúdo */
            margin-left: auto; /* Centraliza o bloco de controle de XP/Level */
            margin-right: auto; /* Centraliza o bloco de controle de XP/Level */
        }
        .xp-control label {
            white-space: nowrap; /* Impede que a label quebre linha */
            display: flex;
            align-items: center;
        }
        .xp-control input, .xp-control select, .xp-control button {
            width: auto; /* Ajusta a largura dos elementos no controle de XP */
        }

        /* Animação de ganho de XP */
        .xp-gain {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: var(--highlight-color);
            font-weight: bold;
            animation: fadeUp 1.5s forwards;
            pointer-events: none;
            text-shadow: 1px 1px 5px rgba(255, 255, 255, 0.5);
        }
        @keyframes fadeUp {
            0% { opacity: 1; transform: translate(-50%, -50%); }
            100% { opacity: 0; transform: translate(-50%, -150%); }
        }

        /* Estilos para os menus colapsáveis */
        .collapsible {
            background-color: var(--main-color);
            color: var(--font-color);
            cursor: pointer;
            padding: 18px;
            width: 100%; /* Ocupa 100% do .main-container */
            border: none;
            text-align: left;
            outline: none;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0 0; /* Margem superior, sem laterais */
            border-radius: 10px 10px 0 0;
            border: 1px solid #444;
            border-bottom: none;
            position: relative;
            box-sizing: border-box; /* Garante que padding e border não aumentem a largura */
        }

        .collapsible:after {
            content: '\002B';
            color: var(--highlight-color);
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .active:after {
            content: '\2212';
        }

        .content {
            width: 100%; /* Ocupa 100% do .main-container */
            margin: 0 0 20px; /* Margem inferior, sem laterais */
            padding: 0 18px; /* Padding interno */
            background-color: var(--main-color);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            border-radius: 0 0 10px 10px;
            border: 1px solid #444;
            border-top: none;
            box-sizing: border-box; /* Garante que padding e border não aumentem a largura */
        }

        .section-container {
            margin-bottom: 30px;
        }
    </style>
</head>
<body>

    <div class="main-container">
        <h1>📜 Lista de Itens </h1>

        <div class="section-container">
            <button type="button" class="collapsible">Nível (0 - MAX)</button>
            <div class="content">
                <div class="level-display">Nível: <span id="playerLevel">1</span></div>
                <div class="xp-container">
                    <div class="xp-bar" id="xpBar"></div>
                    <div class="xp-text" id="xpText">0 / 300 XP</div>
                </div>

                <div class="xp-control">
                    <label>XP:</label>
                    <input type="number" id="xpInput" min="0" value="0">
                    <label>Level:</label>
                    <select id="levelInput"></select>
                    <button onclick="applyManualChanges()">Aplicar</button>
                </div>
            </div>

            <button type="button" class="collapsible">Modifier de Grinding</button>
            <div class="content">
                <div style="padding: 20px;">
                    <p>Configurações de grinding serão adicionadas aqui.</p>
                </div>
            </div>

            <button type="button" class="collapsible">Lista de Itens</button>
            <div class="content">
                <div class="scroll" id="itemList"></div>
            </div>

            <button type="button" class="collapsible">Gerenciar (JSON import e export)</button>
            <div class="content">
                <div class="backup-buttons">
                    <button onclick="exportBackup()">Exportar Backup 💾</button>
                    <button onclick="document.getElementById('importInput').click()">Importar Backup 📂</button>
                    <input type="file" id="importInput" accept=".json" style="display: none;">
                </div>
            </div>
        </div>

        <div class="crud">
            <h3 style="margin-top: 0; color: var(--highlight-color);">Adicionar Item</h3>
            <input type="text" id="itemName" placeholder="Nome do Item">
            <input type="number" id="itemValue" placeholder="Valor">
            <input type="file" id="itemImageInput" accept="image/*">
            <button onclick="addItem()">Adicionar</button>
        </div>
    </div>

    <script>
        let items = JSON.parse(localStorage.getItem('mmorpgItems')) || [];

        const MAX_LEVEL = 99; // Nível máximo antes de começar o Paragon

        let playerXP = parseInt(localStorage.getItem('playerXP')) || 0;
        let playerLevel = parseInt(localStorage.getItem('playerLevel')) || 1;
        let paragonLevel = parseInt(localStorage.getItem('paragonLevel')) || 0;
        let paragonPoints = parseInt(localStorage.getItem('paragonPoints')) || 0;

        // Fórmulas de XP baseadas em Diablo 2
        function getXPToNextLevel(level) {
            if (level >= MAX_LEVEL) {
                // Lógica Paragon (Diablo 3)
                return 25000 + (paragonLevel * 500);
            } else {
                // Lógica Diablo 2
                return Math.floor(Math.pow(level, 2) * 100 + level * 500 + 1000);
            }
        }

        // Preenche o select de levels até o nível máximo
        const levelSelect = document.getElementById('levelInput');
        for (let lvl = 1; lvl <= MAX_LEVEL; lvl++) {
            let opt = document.createElement('option');
            opt.value = lvl;
            opt.textContent = lvl;
            levelSelect.appendChild(opt);
        }

        function renderItems() {
            const list = document.getElementById('itemList');
            list.innerHTML = '';
            items.forEach((item, index) => {
                list.innerHTML += `
                    <div class="item">
                        <img src="${item.image}" alt="${item.name}">
                        <span>${item.name}</span>
                        <span>${item.value}</span>
                        <button onclick="deleteItem(${index})">🗑️</button>
                    </div>
                `;
            });
        }

        function addItem() {
            const name = document.getElementById('itemName').value;
            const value = document.getElementById('itemValue').value;
            const imageInput = document.getElementById('itemImageInput');
            const file = imageInput.files[0];

            if (name && value && file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const image = e.target.result;
                    items.push({ name, value, image });
                    localStorage.setItem('mmorpgItems', JSON.stringify(items));
                    renderItems();
                    document.getElementById('itemName').value = '';
                    document.getElementById('itemValue').value = '';
                    imageInput.value = '';
                };
                reader.readAsDataURL(file);
            }
        }

        function deleteItem(index) {
            if (confirm('Tem certeza que deseja deletar este item?')) {
                items.splice(index, 1);
                localStorage.setItem('mmorpgItems', JSON.stringify(items));
                renderItems();
                gainXP(100);
            }
        }

        function gainXP(amount) {
            playerXP += amount;
            showXPGain(amount);
            
            let xpToNext = getXPToNextLevel(playerLevel);

            if (playerLevel < MAX_LEVEL) {
                if (playerXP >= xpToNext) {
                    playerLevel++;
                    playerXP -= xpToNext;
                    alert(`🎉 Você subiu para o nível ${playerLevel}!`);
                }
            } else {
                // Lógica para níveis Paragon
                if (playerXP >= xpToNext) {
                    paragonLevel++;
                    paragonPoints++;
                    playerXP -= xpToNext;
                    alert(`✨ Você subiu para o Nível Paragon ${paragonLevel}! Você tem ${paragonPoints} ponto(s) para distribuir.`);
                }
            }

            saveProgress();
            updateXPBar();
        }

        function showXPGain(amount) {
            const xpElement = document.createElement('div');
            xpElement.className = 'xp-gain';
            xpElement.innerText = `+${amount} XP`;
            document.body.appendChild(xpElement);
            setTimeout(() => xpElement.remove(), 1500);
        }

        function updateXPBar() {
            let xpToNext = getXPToNextLevel(playerLevel);
            let currentXP = playerXP;

            if (playerLevel >= MAX_LEVEL) {
                // Se o jogador já está no nível máximo, a barra de XP representa o progresso do nível Paragon
                xpToNext = getXPToNextLevel(MAX_LEVEL); // Paragon XP
                document.getElementById('playerLevel').innerText = `${MAX_LEVEL} (Paragon ${paragonLevel})`;
                
            } else {
                document.getElementById('playerLevel').innerText = playerLevel;
            }

            const percent = (currentXP / xpToNext) * 100;
            document.getElementById('xpBar').style.width = percent + '%';
            
            let xpDisplayText = `${currentXP} / ${xpToNext} XP`;
            document.getElementById('xpText').innerText = xpDisplayText;
            
            // Atualiza inputs
            document.getElementById('xpInput').value = currentXP;
            document.getElementById('levelInput').value = playerLevel;
        }

        function saveProgress() {
            localStorage.setItem('playerXP', playerXP);
            localStorage.setItem('playerLevel', playerLevel);
            localStorage.setItem('paragonLevel', paragonLevel);
            localStorage.setItem('paragonPoints', paragonPoints);
            localStorage.setItem('mmorpgItems', JSON.stringify(items)); // Salvando os itens também
        }

        // Aplicar mudanças manuais
        function applyManualChanges() {
            let newXP = parseInt(document.getElementById('xpInput').value) || 0;
            let newLevel = parseInt(document.getElementById('levelInput').value) || 1;
            
            // Validação de inputs para evitar números negativos
            newXP = Math.max(0, newXP);
            newLevel = Math.max(1, newLevel);

            if (newLevel <= MAX_LEVEL) {
                playerXP = newXP;
                playerLevel = newLevel;
                paragonLevel = 0;
                paragonPoints = 0;
            } else {
                alert(`Nível máximo é ${MAX_LEVEL}. Para ir além, use a lógica de Paragon.`);
            }

            saveProgress();
            updateXPBar();
        }

        /* --- NOVAS FUNÇÕES DE BACKUP --- */

        // Função para exportar os dados como um arquivo JSON
        function exportBackup() {
            // Cria um objeto com todos os dados que você quer salvar
            const backupData = {
                items: items,
                playerXP: playerXP,
                playerLevel: playerLevel,
                paragonLevel: paragonLevel,
                paragonPoints: paragonPoints
            };
            
            // Converte o objeto para uma string JSON formatada
            const dataStr = JSON.stringify(backupData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            
            // Cria um link temporário para download
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gamify-backup.json';
            
            // Simula o clique e remove o link
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Backup exportado com sucesso!');
        }

        // Lida com o evento de seleção de arquivo
        document.getElementById('importInput').addEventListener('change', importBackup);

        // Função para importar os dados a partir de um arquivo JSON
        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            if (confirm('Importar um backup irá sobrescrever seus dados atuais. Deseja continuar?')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // Faz o parsing do JSON do arquivo
                        const importedData = JSON.parse(e.target.result);
                        
                        // Atualiza as variáveis do jogo com os dados importados
                        items = importedData.items || [];
                        playerXP = importedData.playerXP || 0;
                        playerLevel = importedData.playerLevel || 1;
                        paragonLevel = importedData.paragonLevel || 0;
                        paragonPoints = importedData.paragonPoints || 0;
                        
                        // Salva os novos dados no localStorage e renderiza a tela
                        saveProgress();
                        renderItems();
                        updateXPBar();
                        alert('Backup importado com sucesso!');
                    } catch (error) {
                        alert('Erro ao importar o arquivo. Verifique se é um arquivo JSON válido.');
                        console.error('Erro ao fazer o parsing do JSON:', error);
                    }
                };
                reader.readAsText(file);
            }
            
            // Limpa o input de arquivo para permitir a importação do mesmo arquivo novamente
            event.target.value = '';
        }
        
        // Garante que o select de nível esteja atualizado com o valor salvo
        levelSelect.value = playerLevel;

        // Adiciona funcionalidade aos menus colapsáveis
        var coll = document.getElementsByClassName("collapsible");
        for (var i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.maxHeight){
                    content.style.maxHeight = null;
                } else {
                    // Adiciona um pequeno atraso para o cálculo do scrollHeight ser preciso
                    setTimeout(() => {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }, 0);
                }
            });
        }

        // Abre o primeiro menu por padrão
        // Atraso para garantir que o DOM esteja totalmente renderizado e scrollHeight correto
        setTimeout(() => {
            if (coll.length > 0) {
                coll[0].click();
            }
        }, 100);


        renderItems();
        updateXPBar();
    </script>
</body>
</html>